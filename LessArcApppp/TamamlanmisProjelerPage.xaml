<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:LessArcApppp.Controls"
    x:Class="LessArcApppp.TamamlanmisProjelerPage"
    x:Name="__page"
    BackgroundColor="Transparent"
    NavigationPage.HasNavigationBar="False"
    Shell.NavBarIsVisible="False"
    Title=""
    SizeChanged="ContentPage_SizeChanged">

    <!-- ÜST BAR + GÖVDE -->
    <Grid RowDefinitions="Auto,*">

        <!-- 🔹 Title Bar -->
        <controls:CustomTitleBar Grid.Row="0"
                                 Title=""
                                 ShowBack="True" />

        <!-- 🔹 GÖVDE -->
        <Grid Grid.Row="1">
            <!-- Arka plan -->
            <Image Source="arkaplann.png"
                   Aspect="AspectFill"
                   HorizontalOptions="Fill"
                   VerticalOptions="Fill"
                   InputTransparent="True" />

            <!-- ========== MASAÜSTÜ ========== -->
            <ScrollView x:Name="desktopLayout" IsVisible="False">
                <VerticalStackLayout Padding="{Binding P_Page}"
                                     Spacing="{Binding S_L}"
                                     HorizontalOptions="Center">

                    <Label Text="✔ TAMAMLANMIŞ PROJELER"
                           FontSize="{Binding F_Title}"
                           FontAttributes="Bold"
                           TextColor="#D0CFCF"
                           HorizontalOptions="Center"
                           Margin="0,10" />

                    <!-- Filtre Kartı -->
                    <Frame WidthRequest="420"
                           BackgroundColor="#FFFFFF"
                           CornerRadius="{Binding C_Radius}"
                           HasShadow="True"
                           Padding="{Binding P_CardPad}"
                           Margin="0,10">

                        <VerticalStackLayout Spacing="{Binding S_M}">

                            <!-- Arama -->
                            <Frame BackgroundColor="#F3F3F3"
                                   CornerRadius="{Binding C_SmallRadius}"
                                   Padding="0"
                                   HasShadow="False"
                                   HeightRequest="44">
                                <Entry x:Name="entryAra"
                                       Placeholder="🔍 Proje ara"
                                       PlaceholderColor="#5C5C5C"
                                       TextChanged="entryAra_TextChanged"
                                       FontSize="{Binding F_Body}"
                                       TextColor="#1E1E1E"
                                       VerticalOptions="Center"
                                       HorizontalTextAlignment="Center"
                                       BackgroundColor="Transparent"
                                       Margin="12,0"/>
                            </Frame>

                            <!-- Yıl Filtresi -->
                            <Grid ColumnDefinitions="Auto,*"
                                  ColumnSpacing="{Binding S_M}"
                                  HeightRequest="46"
                                  VerticalOptions="Center">
                                <Label Text="📅 Yıl Filtresi:"
                                       FontSize="{Binding F_Body}"
                                       TextColor="#1E1E1E"
                                       VerticalOptions="Center" />
                                <Frame Grid.Column="1"
                                       BackgroundColor="#EEEEEE"
                                       BorderColor="#D0CFCF"
                                       CornerRadius="{Binding C_SmallRadius}"
                                       Padding="8,0"
                                       HasShadow="False"
                                       HeightRequest="46">
                                    <Grid>
                                        <Picker x:Name="pickerYil"
                                                Title=""
                                                ItemDisplayBinding="{Binding .}"
                                                TextColor="Transparent"
                                                BackgroundColor="Transparent"
                                                FontSize="{Binding F_Body}"
                                                HorizontalOptions="Fill"
                                                VerticalOptions="Fill"
                                                Opacity="0.01"
                                                SelectedIndexChanged="pickerYil_SelectedIndexChanged"/>
                                        <Label HorizontalOptions="Fill"
                                               HorizontalTextAlignment="Center"
                                               VerticalOptions="Center"
                                               TextColor="#1E1E1E"
                                               FontSize="{Binding F_Body}"
                                               InputTransparent="True"
                                               ZIndex="10"
                                               Text="{Binding Source={x:Reference pickerYil}, Path=SelectedItem, StringFormat='{}{0}', TargetNullValue=Tüm Yıllar}" />
                                    </Grid>
                                </Frame>
                            </Grid>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Proje Kartları -->
                    <CollectionView x:Name="cvProjeler"
                                    WidthRequest="700"
                                    ItemsSource="{Binding FiltreliProjeler}">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="{Binding S_L}" />
                        </CollectionView.ItemsLayout>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#ebe9e5"
                                       CornerRadius="{Binding C_Radius}"
                                       Padding="{Binding P_ItemPad}"
                                       Margin="0"
                                       HasShadow="True">
                                    <VerticalStackLayout Spacing="{Binding S_S}">
                                        <Label Text="PROJE ADI :" FontAttributes="Bold" FontSize="{Binding F_Small}" TextColor="#555"/>
                                        <Label Text="{Binding Baslik}" FontSize="{Binding F_Body}" TextColor="#1E1E1E"/>

                                        <BoxView HeightRequest="1" BackgroundColor="#DDDDDD" Margin="0,8,0,4"/>

                                        <Label Text="PROJEYİ ÇİZEN KİŞİ :" FontAttributes="Bold" FontSize="{Binding F_Small}" TextColor="#555"/>
                                        <Label Text="{Binding KullaniciAdSoyad, TargetNullValue='-'}" FontSize="{Binding F_Body}" TextColor="#333"/>

                                        <BoxView HeightRequest="1" BackgroundColor="#DDDDDD" Margin="0,8,0,4"/>

                                        <Label Text="BAŞLANGIÇ TARİHİ :" FontAttributes="Bold" FontSize="{Binding F_Small}" TextColor="#555"/>
                                        <Label Text="{Binding BaslangicTarihiFormatted}" FontSize="{Binding F_Body}" TextColor="#333"/>

                                        <Label Text="BİTİŞ TARİHİ :" FontAttributes="Bold" FontSize="{Binding F_Small}" TextColor="#555" Margin="0,8,0,0"/>
                                        <Label Text="{Binding BitisTarihiFormatted}" FontSize="{Binding F_Body}" TextColor="#333"/>

                                        <Label Text="{Binding SureFormatted}" FontSize="{Binding F_Small}" TextColor="#4E4E4E" Margin="0,8,0,0"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>

                        <CollectionView.Footer>
                            <Grid HeightRequest="24"/>
                        </CollectionView.Footer>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>
            <!-- ========== MOBİL ========== -->
            <ScrollView x:Name="mobileLayout" IsVisible="True">
                <VerticalStackLayout Padding="{Binding P_Page}" Spacing="{Binding S_M}">

                    <Label Text="✔ TAMAMLANMIŞ PROJELER"
                       FontSize="{Binding F_Title}" FontAttributes="Bold"
                       TextColor="#D0CFCF" HorizontalOptions="Center" Margin="0,10" />

                    <!-- Arama -->
                    <Frame BackgroundColor="#F3F3F3"
                       CornerRadius="{Binding C_SmallRadius}"
                       Padding="0"
                       HasShadow="False"
                       HeightRequest="44">
                        <Entry x:Name="entryAraMobile"
                           Placeholder="🔍 Proje ara"
                           PlaceholderColor="#5C5C5C"
                           TextChanged="entryAra_TextChanged"
                           FontSize="{Binding F_Body}"
                           TextColor="#1E1E1E"
                           VerticalOptions="Center"
                           HorizontalTextAlignment="Center"
                           BackgroundColor="Transparent"
                           Margin="12,0"/>
                    </Frame>

                    <!-- Yıl Filtresi (Picker görünmez, Label gösterir) -->
                    <Grid ColumnDefinitions="Auto,*"
                      ColumnSpacing="{Binding S_M}"
                      HeightRequest="46"
                      VerticalOptions="Center">
                        <Label Text="📅 Yıl Filtresi:" FontSize="{Binding F_Body}" TextColor="#1E1E1E" VerticalOptions="Center" />
                        <Frame Grid.Column="1"
                           BackgroundColor="#EEEEEE"
                           BorderColor="#D0CFCF"
                           CornerRadius="{Binding C_SmallRadius}"
                           Padding="8,0"
                           HasShadow="False"
                           HeightRequest="46">
                            <Grid>
                                <!-- 👇 ItemsSource code-behind’da atanacak (string listesi) -->
                                <Picker x:Name="pickerYilMobile"
                                    BackgroundColor="Transparent"
                                    TextColor="Transparent"
                                    FontSize="{Binding F_Body}"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill"
                                    Opacity="0.02"
                                    SelectedIndexChanged="pickerYil_SelectedIndexChanged"/>
                                <Label HorizontalOptions="Fill"
                                   HorizontalTextAlignment="Center"
                                   VerticalOptions="Center"
                                   TextColor="#1E1E1E"
                                   FontSize="{Binding F_Body}"
                                   InputTransparent="True"
                                   ZIndex="10"
                                   Text="{Binding Source={x:Reference pickerYilMobile},
                                                  Path=SelectedItem,
                                                  TargetNullValue=Tüm Yıllar}" />
                            </Grid>
                        </Frame>
                    </Grid>

                    <!-- Proje Kartları (Mobil) -->
                    <CollectionView x:Name="cvProjelerMobile"
                                ItemsSource="{Binding FiltreliProjeler}">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="{Binding S_L}" />
                        </CollectionView.ItemsLayout>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#ebe9e5"
                                   CornerRadius="{Binding C_Radius}"
                                   Padding="{Binding P_ItemPad}"
                                   Margin="0"
                                   HasShadow="True">
                                    <VerticalStackLayout Spacing="{Binding S_S}">
                                        <Label Text="PROJE ADI :" FontAttributes="Bold" FontSize="{Binding F_Small}" TextColor="#555"/>
                                        <Label Text="{Binding Baslik}" FontSize="{Binding F_Body}" TextColor="#1E1E1E"/>

                                        <BoxView HeightRequest="1" BackgroundColor="#DDDDDD" Margin="0,8,0,4"/>

                                        <Label Text="PROJEYİ ÇİZEN KİŞİ :" FontAttributes="Bold" FontSize="{Binding F_Small}" TextColor="#555"/>
                                        <Label Text="{Binding KullaniciAdSoyad, TargetNullValue='-'}" FontSize="{Binding F_Body}" TextColor="#333"/>

                                        <BoxView HeightRequest="1" BackgroundColor="#DDDDDD" Margin="0,8,0,4"/>

                                        <Label Text="BAŞLANGIÇ TARİHİ :" FontAttributes="Bold" FontSize="{Binding F_Small}" TextColor="#555"/>
                                        <Label Text="{Binding BaslangicTarihiFormatted}" FontSize="{Binding F_Body}" TextColor="#333"/>

                                        <Label Text="BİTİŞ TARİHİ :" FontAttributes="Bold" FontSize="{Binding F_Small}" Margin="0,8,0,0" TextColor="#555"/>
                                        <Label Text="{Binding BitisTarihiFormatted}" FontSize="{Binding F_Body}" TextColor="#333"/>

                                        <Label Text="{Binding SureFormatted}" FontSize="{Binding F_Small}" TextColor="#4E4E4E" Margin="0,8,0,0"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>

                        <CollectionView.Footer>
                            <Grid HeightRequest="24"/>
                        </CollectionView.Footer>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>
        </Grid>
    </Grid>
</ContentPage>